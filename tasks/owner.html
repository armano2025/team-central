<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>משימות – בעלים</title>

  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="./tasks.css" />
  <meta name="theme-color" content="#2563eb" />

  <style>
    /* ====== טעינה (skeleton) ====== */
    .loader-wrap { margin: 16px 0; display:none; }
    .skeleton {
      position: relative; overflow: hidden;
      background: #f3f4f6; border-radius: 12px; height: 72px;
      border: 1px solid #eee;
    }
    .skeleton + .skeleton { margin-top: 10px; }
    .skeleton::after {
      content: ""; position: absolute; inset: 0;
      transform: translateX(-100%);
      background-image: linear-gradient(90deg, rgba(255,255,255,0) 0%,
        rgba(255,255,255,.5) 50%, rgba(255,255,255,0) 100%);
      animation: shimmer 1.2s infinite;
    }
    @keyframes shimmer { 100% { transform: translateX(100%); } }

    /* הודעת שגיאה */
    .error-card {
      border:1px solid #ef4444; color:#ef4444; background:#fff;
      padding:14px; border-radius:12px; margin:16px 0;
    }

    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width:720px){ .grid-2 { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <!-- פס טעינה עליון -->
  <div id="topLoader" class="top-loader" hidden></div>

  <!-- חזרה לאדמין -->
  <a class="back-link" href="../admin.html">← חזרה למסך אדמין</a>

  <header class="page-header">
    <div class="container">
      <h1 id="ownerTitle">משימות</h1>

      <div class="search-wrap" style="margin-top:8px;">
        <input id="ownerSearch" type="search" placeholder="חפש לפי שם / טלפון / נושא / caseId…" />
        <button id="btnOwnerSearch" class="btn">סנן</button>
        <button id="btnOwnerClear" class="btn ghost">נקה</button>
        <button id="btnOwnerRefresh" class="btn ghost" title="רענון נתונים">רענן</button>
      </div>

      <div id="ownerStats" class="muted" style="margin-top:8px;">
        לטיפול: 0 | בתהליך: 0 | בוצע: 0 | בוטל: 0
      </div>
    </div>
  </header>

  <main class="container">
    <!-- טעינה -->
    <div id="loader" class="loader-wrap">
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
    </div>

    <!-- שגיאה -->
    <div id="errBox" class="error-card" style="display:none;">
      שגיאת טעינה מהשרת. בדוק/י את כתובת ה-API או את החיבור לרשת.
    </div>

    <!-- רשימת משימות -->
    <section id="tasksList" class="results-list"></section>
  </main>

  <!-- מודאל עריכת משימה -->
  <dialog id="taskDialog">
    <form method="dialog" id="taskForm" class="card">
      <h3 id="dlgTitle">משימה</h3>

      <div class="grid-2">
        <label>סטטוס
          <select id="f_status">
            <option>לטיפול</option>
            <option>בתהליך</option>
            <option>בוצע</option>
            <option>בוטל</option>
          </select>
        </label>
        <label>מטפל
          <select id="f_owner">
            <option value="">לא משויך</option>
            <option>חן</option>
            <option>תמרה</option>
            <option>בלה</option>
            <option>ליאור</option>
            <option>נטע</option>
          </select>
        </label>
      </div>

      <div class="grid-2">
        <label>שם
          <input id="f_name" type="text" disabled />
        </label>
        <label>טלפון
          <input id="f_phone" type="text" disabled />
        </label>
      </div>

      <label>הערות אדמין
        <textarea id="f_notes" rows="5" placeholder="רשום כאן הערות לניהול פנימי…"></textarea>
      </label>

      <div class="actions">
        <button type="button" id="btnSave" class="btn primary">שמירה</button>
        <button id="btnClose" class="btn ghost">סגור</button>
      </div>
      <input type="hidden" id="f_caseId" />
    </form>
  </dialog>

  <!-- שבירת קאש לגרסה -->
  <script src="./owner.js?v=4"></script>
</body>
</html>